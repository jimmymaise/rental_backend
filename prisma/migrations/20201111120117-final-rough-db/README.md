# Migration `20201111120117-final-rough-db`

This migration has been generated by Phat Tran at 11/11/2020, 7:01:17 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."RentingMandatoryVerifyDocumentDataType" AS ENUM ('Label', 'Currency')

CREATE TYPE "public"."UserNotificationType" AS ENUM ('NewRequestRenting', 'RequestRentingIsApproved', 'NewCommentInRequestRenting')

ALTER TABLE "public"."Item" DROP COLUMN "maxQuantity",
ADD COLUMN "checkBeforeRentDocuments" jsonb []  ,
ADD COLUMN "keepWhileRentingDocuments" jsonb []  ,
ADD COLUMN "availableQuantity" integer   NOT NULL DEFAULT 1,
ADD COLUMN "totalQuantity" integer   NOT NULL DEFAULT 1

CREATE TABLE "public"."RentingMandatoryVerifyDocument" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"dataType" "RentingMandatoryVerifyDocumentDataType"  NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ItemRentingDate" (
"id" text   NOT NULL ,
"rentingItemRequestId" text   NOT NULL ,
"itemId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ItemReview" (
"id" text   NOT NULL ,
"itemId" text   NOT NULL ,
"reviewScore" integer   NOT NULL ,
"reviewComment" text   NOT NULL ,
"ownerUserId" text   NOT NULL ,
"isDeleted" boolean   DEFAULT false,
"createdDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedBy" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."LenderReview" (
"id" text   NOT NULL ,
"lenderId" text   NOT NULL ,
"reviewScore" integer   NOT NULL ,
"reviewComment" text   NOT NULL ,
"ownerUserId" text   NOT NULL ,
"isDeleted" boolean   DEFAULT false,
"createdDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedBy" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RentingItemRequestComment" (
"id" text   NOT NULL ,
"itemId" text   NOT NULL ,
"content" text   ,
"files" jsonb []  ,
"isLocked" boolean   DEFAULT false,
"lockedBy" text   NOT NULL ,
"isDisabled" boolean   DEFAULT false,
"isDeleted" boolean   DEFAULT false,
"createdDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedBy" text   NOT NULL ,
"isSystem" boolean   DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."SearchKeywork" (
"id" text   NOT NULL ,
"keywork" text   ,
"count" integer   DEFAULT 0,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."UserLoginLog" (
"id" text   NOT NULL ,
"ownerUserId" text   NOT NULL ,
"ipAddress" text   NOT NULL ,
"signedInDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."UserNotification" (
"id" text   NOT NULL ,
"forUserId" text   NOT NULL ,
"title" text   NOT NULL ,
"content" text   NOT NULL ,
"images" jsonb []  ,
"type" "UserNotificationType"  NOT NULL ,
"isRead" boolean   DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."WishingItemList" (
"id" text   NOT NULL ,
"ownerUserId" text   NOT NULL ,
"itemId" text   NOT NULL ,
"createdDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."MyUserContactList" (
"id" text   NOT NULL ,
"ownerUserId" text   NOT NULL ,
"userId" text   NOT NULL ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."ItemRentingDate" ADD FOREIGN KEY("rentingItemRequestId")REFERENCES "public"."RentingItemRequest"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ItemRentingDate" ADD FOREIGN KEY("itemId")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ItemReview" ADD FOREIGN KEY("itemId")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RentingItemRequestComment" ADD FOREIGN KEY("itemId")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."WishingItemList" ADD FOREIGN KEY("itemId")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201108134856-update..20201111120117-final-rough-db
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -79,16 +79,19 @@
   Rejected
   Published
 }
+// areas, FE will use the last area, it's smallest unit
 model Item {
   id                      String          @id @default(uuid())
   name                    String
   slug                    String          @unique
   description             String?
   categories              Category[]      @relation(references: [id])
   areas                   Area[]          @relation(references: [id])
   images                  Json[]
+  checkBeforeRentDocuments         Json[]
+  keepWhileRentingDocuments        Json[]
   unavailableForRentDays  DateTime[]
   currentOriginalPrice    Float?
   sellPrice               Float?
   rentPricePerDay         Float?
@@ -96,9 +99,10 @@
   rentPricePerMonth       Float?
   currencyCode            String?
   summaryReviewCore       Float?
   summaryReviewCount      Float?
-  maxQuantity             Int             @default(1)
+  availableQuantity             Int             @default(1)
+  totalQuantity             Int             @default(1)
   isVerified              Boolean?        @default(false)
   status                  ItemStatus
   note                    String?
   ownerUserId             String
@@ -106,21 +110,22 @@
   isDeleted               Boolean?        @default(false)
   createdDate             DateTime        @default(now())
   updatedDate             DateTime        @default(now())
   updatedBy               String
+  itemRentingDates        ItemRentingDate[]
 }
-// Item Reviews?
-// Renting Request Comments? with attach files
-// Cho phep khoa comment, do chu shop khoa, thi comment ko the chinh sua hoac xoa nua
-// Renting Request Review
+enum RentingMandatoryVerifyDocumentDataType {
+  Label
+  Currency
+}
-// Log Search Keywork
-// Log User Signed In
-// Item Yeu Thich
-// Luu danh ba nguoi cho thue
-// User Notifications
-// Log user sharing
+// tien coc, bang lai xe, 
+model RentingMandatoryVerifyDocument {
+  id                      String          @id @default(uuid())
+  name                    String
+  dataType                RentingMandatoryVerifyDocumentDataType
+}
 enum RentingItemRequestStatus {
   Declined
   Approved
@@ -155,6 +160,111 @@
   isDeleted               Boolean?        @default(false)
   createdDate             DateTime        @default(now())
   updatedDate             DateTime        @default(now())
   updatedBy               String
+  itemRentingDates        ItemRentingDate[]
 }
+model ItemRentingDate {
+  id                      String          @id @default(uuid())
+  rentingItemRequest    RentingItemRequest  @relation(fields: [rentingItemRequestId], references: [id])
+  rentingItemRequestId  String
+  rentingItem           Item @relation(fields: [itemId], references: [id])
+  itemId                String
+}
+
+model ItemReview {
+  id                      String          @id @default(uuid())
+  rentingItem           Item @relation(fields: [itemId], references: [id])
+  itemId                String
+  reviewScore           Int
+  reviewComment         String
+  ownerUserId             String
+  isDeleted               Boolean?        @default(false)
+  createdDate             DateTime        @default(now())
+  updatedDate             DateTime        @default(now())
+  updatedBy               String
+}
+
+model LenderReview {
+  id                      String          @id @default(uuid())
+  lenderId              String
+  reviewScore           Int
+  reviewComment         String
+  ownerUserId             String
+  isDeleted               Boolean?        @default(false)
+  createdDate             DateTime        @default(now())
+  updatedDate             DateTime        @default(now())
+  updatedBy               String
+}
+
+model RentingItemRequestComment {
+  id                      String          @id @default(uuid())
+  rentingItem           Item @relation(fields: [itemId], references: [id])
+  itemId                String
+  content             String?
+  files                 Json[]
+  isLocked              Boolean?        @default(false)
+  lockedBy               String
+  isDisabled              Boolean?        @default(false)
+  isDeleted               Boolean?        @default(false)
+  createdDate             DateTime        @default(now())
+  updatedDate             DateTime        @default(now())
+  updatedBy               String
+  isSystem              Boolean?        @default(false)
+}
+
+// Log Systems
+model SearchKeywork {
+  id                      String          @id @default(uuid())
+  keywork             String?
+  count               Int?  @default(0)
+}
+
+model UserLoginLog {
+   id                      String          @id @default(uuid())
+   ownerUserId             String
+   ipAddress               String
+   signedInDate             DateTime        @default(now())
+}
+
+enum UserNotificationType {
+  NewRequestRenting
+  RequestRentingIsApproved
+  NewCommentInRequestRenting
+}
+
+model UserNotification {
+  id      String          @id @default(uuid())
+  forUserId             String
+  title             String
+  content             String
+  images            Json[]
+  type              UserNotificationType
+  isRead          Boolean?        @default(false)
+}
+
+model WishingItemList {
+  id      String          @id @default(uuid())
+  ownerUserId             String
+  item           Item @relation(fields: [itemId], references: [id])
+  itemId          String
+  createdDate             DateTime        @default(now())
+}
+
+model MyUserContactList {
+  id      String          @id @default(uuid())
+  ownerUserId             String
+  userId                  String
+}
+
+// Item Reviews?
+// Renting Request Comments? with attach files
+// Cho phep khoa comment, do chu shop khoa, thi comment ko the chinh sua hoac xoa nua
+// Renting Request Review
+
+// Log Search Keywork
+// Log User Signed In
+// Item Yeu Thich
+// Luu danh ba nguoi cho thue
+// User Notifications
+// Log user sharing
```



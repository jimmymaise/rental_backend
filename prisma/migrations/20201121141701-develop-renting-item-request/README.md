# Migration `20201121141701-develop-renting-item-request`

This migration has been generated by Phat Tran at 11/21/2020, 9:17:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "public"."RentingItemRequest.slug_unique"

ALTER TABLE "public"."ItemRentingDate" DROP CONSTRAINT "ItemRentingDate_itemId_fkey"

ALTER TABLE "public"."ItemRentingDate" DROP CONSTRAINT "ItemRentingDate_rentingItemRequestId_fkey"

ALTER TABLE "public"."RentingItemRequestDetail" DROP CONSTRAINT "RentingItemRequestDetail_itemId_fkey"

ALTER TABLE "public"."RentingItemRequestDetail" DROP CONSTRAINT "RentingItemRequestDetail_rentingItemRequestId_fkey"

ALTER TABLE "public"."Item" DROP COLUMN "availableQuantity",
DROP COLUMN "roughAddress"

ALTER TABLE "public"."RentingItemRequest" DROP COLUMN "name",
DROP COLUMN "slug",
DROP COLUMN "description",
DROP COLUMN "isDisabled",
ADD COLUMN "itemId" text   NOT NULL ,
ADD COLUMN "actualAmount" Decimal(65,30)   NOT NULL DEFAULT 0,
ADD COLUMN "rentTotalQuantity" integer   NOT NULL DEFAULT 1

DROP TABLE "public"."ItemRentingDate"

DROP TABLE "public"."RentingItemRequestDetail"

ALTER TABLE "public"."RentingItemRequest" ADD FOREIGN KEY("itemId")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201118214245-add-index..20201121141701-develop-renting-item-request
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -87,10 +87,10 @@
   slug                    String          @unique
   description             String?
   categories              Category[]      @relation(references: [id])
   areas                   Area[]          @relation(references: [id])
+  rentingItemRequests                   RentingItemRequest[]
   images                  String?
-  roughAddress            String?
   checkBeforeRentDocuments         String?
   keepWhileRentingDocuments        String?
   unavailableForRentDays  DateTime[]
   currentOriginalPrice    Float?
@@ -100,9 +100,8 @@
   rentPricePerMonth       Float?
   currencyCode            String?
   summaryReviewCore       Float?
   summaryReviewCount      Float?
-  availableQuantity             Int             @default(1)
   totalQuantity             Int             @default(1)
   isVerified              Boolean?        @default(false)
   status                  ItemStatus
   note                    String?
@@ -110,9 +109,8 @@
   isDeleted               Boolean?        @default(false)
   createdDate             DateTime        @default(now())
   updatedDate             DateTime        @default(now())
   updatedBy               String
-  itemRentingDates        ItemRentingDate[]
   keyword                 String?
   @@index(fields: [name, slug, keyword, status, ownerUserId, isDeleted], name: "item_main_index")
 }
@@ -135,47 +133,26 @@
   InProgress
   Completed
 }
-model RentingItemRequestDetail {
-  id                    String              @id @default(uuid())
-  quantity              Int                 @default(1)
-  amountPerUnit         Float               @default(0)
-  totalAmount           Float               @default(0)
-  item                  Item  @relation(fields: [itemId], references: [id])
-  itemId                String
-  rentingItemRequest    RentingItemRequest  @relation(fields: [rentingItemRequestId], references: [id])
-  rentingItemRequestId  String
-}
-
 model RentingItemRequest {
   id                      String          @id @default(uuid())
-  name                    String
-  slug                    String          @unique
-  description             String?
+  rentingItem           Item @relation(fields: [itemId], references: [id])
+  itemId                String
   totalAmount             Float           @default(0)
+  actualAmount            Float           @default(0)
+  rentTotalQuantity       Int             @default(1)
   fromDate                DateTime
   toDate                  DateTime
-  rentingItemDetails      RentingItemRequestDetail[]
   status                  RentingItemRequestStatus
   ownerUserId             String
   lenderUserId            String
-  isDisabled              Boolean?        @default(false)
   isDeleted               Boolean?        @default(false)
   createdDate             DateTime        @default(now())
   updatedDate             DateTime        @default(now())
   updatedBy               String
-  itemRentingDates        ItemRentingDate[]
 }
-model ItemRentingDate {
-  id                      String          @id @default(uuid())
-  rentingItemRequest    RentingItemRequest  @relation(fields: [rentingItemRequestId], references: [id])
-  rentingItemRequestId  String
-  rentingItem           Item @relation(fields: [itemId], references: [id])
-  itemId                String
-}
-
 model ItemReview {
   id                      String          @id @default(uuid())
   rentingItem           Item @relation(fields: [itemId], references: [id])
   itemId                String
```



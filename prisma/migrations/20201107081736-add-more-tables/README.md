# Migration `20201107081736-add-more-tables`

This migration has been generated by Phat Tran at 11/7/2020, 3:17:36 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('Admin', 'User')

CREATE TYPE "public"."ItemStatus" AS ENUM ('Draft', 'Blocked', 'Rejected', 'Published')

CREATE TYPE "public"."RentingItemRequestStatus" AS ENUM ('Declined', 'Approved', 'InProgress', 'Completed')

CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"email" text   NOT NULL ,
"name" text   ,
"bio" text   NOT NULL ,
"role" "UserRole"[]  ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Category" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"slug" text   NOT NULL ,
"imageUrl" text   ,
"thumbnailImageUrl" text   ,
"coverImageUrl" text   ,
"parentCategoryId" text   ,
"order" integer   DEFAULT 0,
"isDisabled" boolean   DEFAULT false,
"isDeleted" boolean   DEFAULT false,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FileStorage" (
"id" text   NOT NULL ,
"url" text   NOT NULL ,
"name" text   NOT NULL ,
"bucketName" text   NOT NULL ,
"folderName" text   NOT NULL ,
"contentType" text   NOT NULL ,
"createdBy" text   NOT NULL ,
"createdDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"isDeleted" boolean   DEFAULT false,
"itemId" text   ,
"fileStorageId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Item" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"slug" text   NOT NULL ,
"description" text   ,
"unavailableForRentDays" timestamp(3) []  ,
"currentOriginalPrice" Decimal(65,30)   ,
"sellPrice" Decimal(65,30)   ,
"rentPricePerDay" Decimal(65,30)   ,
"rentPricePerWeek" Decimal(65,30)   ,
"rentPricePerMonth" Decimal(65,30)   ,
"currencyCode" text   ,
"summaryReviewCore" Decimal(65,30)   ,
"summaryReviewCount" Decimal(65,30)   ,
"maxQuantity" integer   NOT NULL DEFAULT 1,
"isVerified" boolean   DEFAULT false,
"status" "ItemStatus"  NOT NULL ,
"note" text   ,
"ownerUserId" text   NOT NULL ,
"isDisabled" boolean   DEFAULT false,
"isDeleted" boolean   DEFAULT false,
"createdDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedBy" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RentingItemRequestDetail" (
"id" text   NOT NULL ,
"quantity" integer   NOT NULL DEFAULT 1,
"amountPerUnit" Decimal(65,30)   NOT NULL DEFAULT 0,
"totalAmount" Decimal(65,30)   NOT NULL DEFAULT 0,
"itemId" text   NOT NULL ,
"rentingItemRequestId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."RentingItemRequest" (
"id" text   NOT NULL ,
"name" text   NOT NULL ,
"slug" text   NOT NULL ,
"description" text   ,
"totalAmount" Decimal(65,30)   NOT NULL DEFAULT 0,
"fromDate" timestamp(3)   NOT NULL ,
"toDate" timestamp(3)   NOT NULL ,
"status" "RentingItemRequestStatus"  NOT NULL ,
"ownerUserId" text   NOT NULL ,
"lenderUserId" text   NOT NULL ,
"isDisabled" boolean   DEFAULT false,
"isDeleted" boolean   DEFAULT false,
"createdDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedBy" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_AreaToItem" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE TABLE "public"."_CategoryToItem" (
"A" text   NOT NULL ,
"B" text   NOT NULL 
)

CREATE UNIQUE INDEX "User.email_unique" ON "public"."User"("email")

CREATE UNIQUE INDEX "Category.slug_unique" ON "public"."Category"("slug")

CREATE UNIQUE INDEX "Item.slug_unique" ON "public"."Item"("slug")

CREATE UNIQUE INDEX "RentingItemRequest.slug_unique" ON "public"."RentingItemRequest"("slug")

CREATE UNIQUE INDEX "_AreaToItem_AB_unique" ON "public"."_AreaToItem"("A", "B")

CREATE INDEX "_AreaToItem_B_index" ON "public"."_AreaToItem"("B")

CREATE UNIQUE INDEX "_CategoryToItem_AB_unique" ON "public"."_CategoryToItem"("A", "B")

CREATE INDEX "_CategoryToItem_B_index" ON "public"."_CategoryToItem"("B")

ALTER TABLE "public"."FileStorage" ADD FOREIGN KEY("fileStorageId")REFERENCES "public"."FileStorage"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FileStorage" ADD FOREIGN KEY("itemId")REFERENCES "public"."Item"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."RentingItemRequestDetail" ADD FOREIGN KEY("itemId")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."RentingItemRequestDetail" ADD FOREIGN KEY("rentingItemRequestId")REFERENCES "public"."RentingItemRequest"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_AreaToItem" ADD FOREIGN KEY("A")REFERENCES "public"."Area"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_AreaToItem" ADD FOREIGN KEY("B")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToItem" ADD FOREIGN KEY("A")REFERENCES "public"."Category"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CategoryToItem" ADD FOREIGN KEY("B")REFERENCES "public"."Item"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201107023636-init..20201107081736-add-more-tables
--- datamodel.dml
+++ datamodel.dml
@@ -2,15 +2,28 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
+enum UserRole {
+  Admin
+  User
+}
+
+model User {
+  id      String      @id @default(uuid())
+  email   String      @unique
+  name    String?
+  bio     String
+  role    UserRole[]
+}
+
 model Area {
   id            String      @id @default(uuid())
   region        String
   name          String
@@ -20,5 +33,120 @@
   longitude     Float
   order         Int?        @default(0)
   isDisabled    Boolean?    @default(false)
   isDeleted     Boolean?    @default(false)
-}
+  items         Item[]      @relation(references: [id])
+}
+
+model Category {
+  id                String      @id @default(uuid())
+  name              String
+  slug              String      @unique
+  imageUrl          String?
+  thumbnailImageUrl String?
+  coverImageUrl     String?
+  parentCategoryId  String?
+  order             Int?        @default(0)
+  isDisabled        Boolean?    @default(false)
+  isDeleted         Boolean?    @default(false)
+  items             Item[]      @relation(references: [id])
+}
+
+model FileStorage {
+  id                String        @id @default(uuid())
+  url               String
+  name              String
+  bucketName        String
+  folderName        String
+  contentType       String
+  createdBy         String
+  createdDate       DateTime      @default(now())
+  isDeleted         Boolean?      @default(false)
+  thumbnail         FileStorage?
+}
+
+enum ItemStatus {
+  Draft
+  Blocked
+  Rejected
+  Published
+}
+
+model Item {
+  id                      String          @id @default(uuid())
+  name                    String
+  slug                    String          @unique
+  description             String?
+  categories              Category[]      @relation(references: [id])
+  areas                   Area[]          @relation(references: [id])
+  images                  FileStorage[]
+  unavailableForRentDays  DateTime[]
+  currentOriginalPrice    Float?
+  sellPrice               Float?
+  rentPricePerDay         Float?
+  rentPricePerWeek        Float?
+  rentPricePerMonth       Float?
+  currencyCode            String?
+  summaryReviewCore       Float?
+  summaryReviewCount      Float?
+  maxQuantity             Int             @default(1)
+  isVerified              Boolean?        @default(false)
+  status                  ItemStatus
+  note                    String?
+  ownerUserId             String
+  isDisabled              Boolean?        @default(false)
+  isDeleted               Boolean?        @default(false)
+  createdDate             DateTime        @default(now())
+  updatedDate             DateTime        @default(now())
+  updatedBy               String
+}
+
+// Item Reviews?
+// Renting Request Comments? with attach files
+// Cho phep khoa comment, do chu shop khoa, thi comment ko the chinh sua hoac xoa nua
+// Renting Request Review
+
+// Log Search Keywork
+// Log User Signed In
+// Item Yeu Thich
+// Luu danh ba nguoi cho thue
+// User Notifications
+// Log user sharing
+
+
+enum RentingItemRequestStatus {
+  Declined
+  Approved
+  InProgress
+  Completed
+}
+
+model RentingItemRequestDetail {
+  id                    String              @id @default(uuid())
+  quantity              Int                 @default(1)
+  amountPerUnit         Float               @default(0)
+  totalAmount           Float               @default(0)
+  item                  Item  @relation(fields: [itemId], references: [id])
+  itemId                String
+  rentingItemRequest    RentingItemRequest  @relation(fields: [rentingItemRequestId], references: [id])
+  rentingItemRequestId  String
+}
+
+model RentingItemRequest {
+  id                      String          @id @default(uuid())
+  name                    String
+  slug                    String          @unique
+  description             String?
+  totalAmount             Float           @default(0)
+  fromDate                DateTime
+  toDate                  DateTime
+  rentingItemDetails      RentingItemRequestDetail[]
+  status                  RentingItemRequestStatus
+  ownerUserId             String
+  lenderUserId            String
+  isDisabled              Boolean?        @default(false)
+  isDeleted               Boolean?        @default(false)
+  createdDate             DateTime        @default(now())
+  updatedDate             DateTime        @default(now())
+  updatedBy               String
+}
+
```


